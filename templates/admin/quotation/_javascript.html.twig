<script>
    jQuery(document).ready(function() {
        $collectionHolder = $('.content tbody');
        $collectionHolder.find('tr').each(function() {
            addLineFormDeleteLink($(this));
        });
        var $lineCollectionHolder = $('.content tbody');
        $lineCollectionHolder.data('index', $lineCollectionHolder.find('input').length);

        $('body').on('click', '.add_item_link', function(e) {
            var $collectionHolderClass = $(e.currentTarget).data('collectionHolderClass');
            addFormToCollection($collectionHolderClass);
        })
    });

    function addFormToCollection($collectionHolderClass) {
        var $collectionHolder = $('.' + $collectionHolderClass);
        var prototype = $collectionHolder.data('prototype');
        var index = $collectionHolder.data('index');

        var newForm = prototype;
        newForm = newForm.replace(/__name__/g, index);

        $collectionHolder.data('index', index + 1);

        var $newFormTr = $('<tr></tr>').append(newForm);

        $collectionHolder.children('tbody').append($newFormTr);
        addLineFormDeleteLink($newFormTr);
    }
    function addLineFormDeleteLink($lineFormTr) {
        var $removeFormButton = $('<button type="button" class="btn btn-danger">Delete this line</button>');
        var $eraseTd = $('<td class="form-group action"></td>').append($removeFormButton);
        $lineFormTr.append($eraseTd);

        $removeFormButton.on('click', function(e) {
            $lineFormTr.remove();
        });
    }

</script>